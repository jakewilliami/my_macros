%%% Hyperlinks, References, and Numeric Citations Typesetting %%%

% NOTE: this file cannot be called hyperref.sty!

% Make citations numeric (and compressed where possible, e.g. [1â€“3] over [1, 2, 3])
\PassOptionsToPackage{
  bibencoding=utf8,
  style=apa,
  bibstyle=apa,
  backend=biber,
  citestyle=numeric-comp,
  sorting=none
}{biblatex}
\RequirePackage{biblatex}
\addbibresource{references.bib}

% Unicode support for Spanish characters
\DeclareUnicodeCharacter{0301}{\'{e}}

% Set hyperlink colours
% Make sure to load colours.sty first
% Hyperlinks are blue which pretty typical for hyperlinks
% Don't need citations to be different colours in this because they are short anyway
\RequirePackage{hypdoc}
\RequirePackage{hyperref}
\AtEndPreamble{\RequirePackage{cleveref}}
\hypersetup{
  colorlinks = true,
  urlcolor = linkblue,
  linkcolor = linkblue,
  citecolor = linkblue,%darkelectricblue,
}

% Add numbers to APA-formatted bibliography
% https://tex.stackexchange.com/a/373395/
\DeclareFieldFormat{labelnumberwidth}{\mkbibbrackets{#1}}
\defbibenvironment{bibliography}{%
  \list{%
    \printtext[labelnumberwidth]{%
      \printfield{labelprefix}%
      \printfield{labelnumber}%
    }%
  }{%
    \setlength{\labelwidth}{\labelnumberwidth}%
    \setlength{\leftmargin}{\labelwidth}%
    \setlength{\labelsep}{\biblabelsep}%
    \addtolength{\leftmargin}{\labelsep}%
    \setlength{\itemsep}{\bibitemsep}%
    \setlength{\parsep}{\bibparsep}%
  }%
  \renewcommand*{\makelabel}[1]{\hss##1}
}%
{\endlist}%
{\item}

% Print bibliography at end of document
\AtEndDocument{
    % Using \clearpage over \newpage
    % https://tex.stackexchange.com/a/141995/
    \clearpage
	\printbibliography
}

%%% End Hyperlinks, References, and Numeric Citations Typesetting %%%
